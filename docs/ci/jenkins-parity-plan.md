# Jenkins Parity Plan (align with GitHub Actions)

This plan documents where the current Jenkins pipeline masks failures and what to change so behavior matches GA: strict gating for UI/API tests; non‑gating for perf/security/mutation, with artifacts and proof lines.

## Masked failures (all occurrences of `|| true`)

- UI – Cypress: `npx cypress run … || true` (both PR smoke and full)
- UI – Playwright: `npx playwright test … || true` (both PR smoke and full)
- UI – Selenium (Grid): `mvn … test || true` (both PR smoke and full); `docker stop grid || true`
- API – Newman + REST Assured: `npm run -s test || true`; `mvn … test || true`
- Perf – k6 & JMeter: `k6 run smoke.js || true`; `docker run … justb4/jmeter:5.6.3 … || true`
- Security – ZAP: `zap-baseline.py … -a -r zap.html || true`
- Mutation – JS (Stryker): `npm ci || true`; `npm run mutate || true`
- Mutation – Java (PIT): `mvn … pitest-maven:mutationCoverage || true`

## Stage parity table

| Stage                   | Current issue                                       | Fix (parity with GA)                                                                                                                         | Proof line(s) to print/check                                        | Gating                                                                                                                                                             |
| ----------------------- | --------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------- | ---------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | ------ |
| UI – Cypress            | `                                                   |                                                                                                                                              | true`hides failures; install uses`npm install`                      | Use `set -euxo pipefail`; switch to `npm ci`; remove `                                                                                                             |                                                                             | true`; PR: `cypress/e2e/smoke/\*_/_.cy.js`, main: full; keep artifact upload | Console “Results” block with counts; ensure videos/screenshots archived                                                               | STRICT |
| UI – Playwright         | `                                                   |                                                                                                                                              | true` hides failures; missing unit step                             | `set -euxo pipefail`; `npm ci`; `npx playwright install --with-deps`; add pre‑step `npm run -s test:unit`; remove `                                                |                                                                             | true`on`npx playwright test`; upload `playwright-report/\*\*`                | “Running N tests … M passed” line; optional Jest summary lines                                                                        | STRICT |
| UI – Selenium (Grid)    | `mvn … test                                         |                                                                                                                                              | true`masks failures;`docker stop grid` in same shell can be skipped | Run grid in stage; move `docker stop grid` to `post { always { … } }`; `mvn -q … test` without `                                                                   |                                                                             | true`; keep `junit` publisher                                                | Print Surefire totals after run: `grep`/awk or a small Groovy/awk to sum tests/failures/errors/skipped; junit plugin will display too | STRICT |
| API – Newman            | Currently runs `npm run -s test` and masks failures | Explicit: `npx newman run collection.json -e env.json -r cli,htmlextra --reporter-htmlextra-export newman.html`; `test -f newman.html`; no ` |                                                                     | true`; archive always                                                                                                                                              | Newman summary table (assertions / duration) and existence of `newman.html` | STRICT                                                                       |
| API – REST Assured      | `mvn … test                                         |                                                                                                                                              | true` masks failures/zero                                           | `mvn -q -Dapi.base=${API_BASE} test`; afterwards parse `target/surefire-reports/TEST-*.xml` and fail when no XML, tests==0, failures>0 or errors>0; archive always | Print “Surefire totals: tests=… failures=… errors=… skipped=…”              | STRICT                                                                       |
| Perf – k6               | Non‑gating but masked                               | Keep `                                                                                                                                       |                                                                     | true`; ensure it runs `k6 run perf-k6/smoke.js`; upload any k6 output if configured                                                                                | Optional “thresholds” summary if added later                                | UNSTABLE                                                                     |
| Perf – JMeter           | `                                                   |                                                                                                                                              | true`; image tag 5.6.3 may be unavailable on some runners           | Keep non‑gating; switch to a valid tag (e.g., `justb4/jmeter:5.5` like GA) and mount `${WORKSPACE}/perf-jmeter`; `test -f html-report/index.html`; archive always  | Check `html-report/index.html` exists; print “Generated HTML dashboard”     | UNSTABLE                                                                     |
| Security – ZAP          | `                                                   |                                                                                                                                              | true` masks runner errors; issue creation permissions may fail      | Keep non‑gating; run `zap-baseline.py -a -r zap.html`; `test -f zap.html`; archive always; do not fail on alerts, only on runner error                             | Ensure “Alerts present …” line prints and `zap.html` exists                 | UNSTABLE                                                                     |
| Mutation – Stryker (JS) | Non‑gating; masked                                  | Keep non‑gating; run `npm ci && npm run mutate`; print mutation score; archive reports                                                       | “Stryker mutation score: X”                                         | UNSTABLE                                                                                                                                                           |
| Mutation – PIT (Java)   | Non‑gating; masked                                  | Keep non‑gating; run PIT; print “PIT mutations total=… killed=… survived=… score=…%”; archive pit-reports                                    | The printed PIT summary                                             | UNSTABLE                                                                                                                                                           |

## Rationale

Matches GA policy: UI and API suites are gating and must fail on real failures or when nothing runs; perf and security produce artifacts and summaries without failing the build (UNSTABLE). Each STRICT step uses `set -euxo pipefail`, removes `|| true`, validates that expected artifacts exist, and prints unambiguous proof lines (Newman table, Surefire totals). This ensures Jenkins results align with GA’s stricter behavior while still retaining artifacts for non‑gating checks.
